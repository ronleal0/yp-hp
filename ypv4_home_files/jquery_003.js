jQuery.autocomplete=function(e,t){function n(){q={},q.data={},q.length=0}function i(){if(46==O||O>8&&32>O)return C.hide();var e=k.val();e!=N&&(N=e,e.length>=t.minChars?(k.addClass(t.loadingClass),m(e)):(k.removeClass(t.loadingClass),C.hide()))}function o(e){var t=$("li",T);t&&(E+=e,0>E?E=0:E>=t.size()&&(E=t.size()-1),t.removeClass("ac_over"),$(t[E]).addClass("ac_over"))}function s(){var e=$("li.ac_over",T)[0];if(!e){var n=$("li",T);t.selectOnly?1==n.length&&(e=n[0]):t.selectFirst&&(e=n[0])}return e?(r(e),!0):!1}function r(n){n||(n=document.createElement("li"),n.extra=[],n.selectValue="");var i=$.trim(n.selectValue?n.selectValue:n.innerHTML);e.lastSelected=i,N=i,C.html(""),k.val(i),d(),t.onItemSelect&&setTimeout(function(){t.onItemSelect(n)},1)}function a(e,t){var n=k.get(0);if(n.createTextRange){var i=n.createTextRange();i.collapse(!0),i.moveStart("character",e),i.moveEnd("character",t),i.select()}else n.setSelectionRange?n.setSelectionRange(e,t):n.selectionStart&&(n.selectionStart=e,n.selectionEnd=t);n.focus()}function l(e){8!=O&&(k.val(k.val()+e.substring(N.length)),a(N.length,e.length))}function c(){var n=w(e),i=t.width>0?t.width:k.width();C.css({width:parseInt(i)+"px",top:n.y+e.offsetHeight+"px",left:n.x+"px"}).show()}function u(){S&&clearTimeout(S),S=setTimeout(d,200)}function d(){if(!j){j=!0,S&&clearTimeout(S);var n=k.removeClass(t.loadingClass).val();C.is(":visible")&&C.hide(),t.mustMatch&&(e.lastSelected&&e.lastSelected==n||r(null)),j=!1}}function p(e,n){if(n){if(k.removeClass(t.loadingClass),T.innerHTML="",!L||0==n.length)return d();$.browser.msie&&C.append(document.createElement("iframe")),T.appendChild(h(n)),t.autoFill&&k.val().toLowerCase()==e.toLowerCase()&&l(n[0][0]),c()}else d()}function f(e){if(!e)return null;for(var n=[],i=e.split(t.lineSeparator),o=0;o<i.length;o++){var s=$.trim(i[o]);s&&(n[n.length]=s.split(t.cellSeparator))}return n}function h(e){var n=document.createElement("ul"),i=e.length;t.maxItemsToShow>0&&t.maxItemsToShow<i&&(i=t.maxItemsToShow);for(var o=0;i>o;o++){var s=e[o];if(s){var a=document.createElement("li");t.formatItem?(a.innerHTML=t.formatItem(s,o,i),a.selectValue=s[0]):(a.innerHTML=s[0],a.selectValue=s[0]);var l=null;if(s.length>1){l=[];for(var c=1;c<s.length;c++)l[l.length]=s[c]}a.extra=l,n.appendChild(a),$(a).hover(function(){$("li",n).removeClass("ac_over"),$(this).addClass("ac_over"),E=$("li",n).indexOf($(this).get(0))},function(){$(this).removeClass("ac_over")}).click(function(e){e.preventDefault(),e.stopPropagation(),r(this)})}}return $(n).mousedown(function(){D=!0}).mouseup(function(){D=!1}),n}function m(e){t.matchCase||(e=e.toLowerCase());var n=t.cacheLength?v(e):null;n?p(e,n):"string"==typeof t.url&&t.url.length>0?$.get(g(e),function(t){t=f(t),x(e,t),p(e,t)}):k.removeClass(t.loadingClass)}function g(e){var n=-1==t.url.indexOf("?")?"?":"&",i=t.url+n+"q="+encodeURI(e);for(var o in t.extraParams)i+="&"+o+"="+encodeURI(t.extraParams[o]);return i}function v(e){if(!e)return null;if(q.data[e])return q.data[e];if(t.matchSubset)for(var n=e.length-1;n>=t.minChars;n--){var i=e.substr(0,n),o=q.data[i];if(o){for(var s=[],r=0;r<o.length;r++){var a=o[r],l=a[0];y(l,e)&&(s[s.length]=a)}return s}}return null}function y(e,n){t.matchCase||(e=e.toLowerCase());var i=e.indexOf(n);return-1==i?!1:0==i||t.matchContains}function b(e,n){n&&k.removeClass(t.loadingClass);for(var i=n?n.length:0,o=null,s=0;i>s;s++){var r=n[s];if(r[0].toLowerCase()==e.toLowerCase()){o=document.createElement("li"),t.formatItem?(o.innerHTML=t.formatItem(r,s,i),o.selectValue=r[0]):(o.innerHTML=r[0],o.selectValue=r[0]);var a=null;if(r.length>1){a=[];for(var l=1;l<r.length;l++)a[a.length]=r[l]}o.extra=a}}t.onFindValue&&setTimeout(function(){t.onFindValue(o)},1)}function x(e,i){i&&e&&t.cacheLength&&(!q.length||q.length>t.cacheLength?(n(),q.length++):q[e]||q.length++,q.data[e]=i)}function w(e){for(var t=e.offsetLeft||0,n=e.offsetTop||0;e=e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop;return{x:t,y:n}}var _=this,k=$(e).attr("autocomplete","off");t.inputClass&&k.addClass(t.inputClass);var T=document.createElement("div"),C=$(T).hide().addClass(t.resultsClass).css("position","absolute");t.width>0&&C.css("width",t.width),$("body").append(T),e.autocompleter=_;var S=null,N="",E=-1,q={},L=!1,O=null,D=!1,j=!1;if(n(),null!=t.data){var A="",P={},F=[];"string"!=typeof t.url&&(t.cacheLength=1);for(var I=0;I<t.data.length;I++)F="string"==typeof t.data[I]?[t.data[I]]:t.data[I],F[0].length>0&&(A=F[0].substring(0,1).toLowerCase(),P[A]||(P[A]=[]),P[A].push(F));for(var M in P)t.cacheLength++,x(M,P[M])}k.keydown(function(e){switch(O=e.keyCode,e.keyCode){case 38:e.preventDefault(),o(-1);break;case 40:e.preventDefault(),o(1);break;case 9:case 13:s()&&(k.get(0).blur(),e.preventDefault());break;default:E=-1,S&&clearTimeout(S),S=setTimeout(function(){i()},t.delay)}}).focus(function(){L=!0}).blur(function(){L=!1,D||u()}),d(),this.flushCache=function(){n()},this.setExtraParams=function(e){t.extraParams=e},this.findValue=function(){var e=k.val();t.matchCase||(e=e.toLowerCase());var n=t.cacheLength?v(e):null;n?b(e,n):"string"==typeof t.url&&t.url.length>0?$.get(g(e),function(t){t=f(t),x(e,t),b(e,t)}):b(e,null)}},jQuery.fn.autocomplete=function(e,t,n){return t=t||{},t.url=e,t.data="object"==typeof n&&n.constructor==Array?n:null,t=$.extend({inputClass:"ac_input",resultsClass:"ac_results",lineSeparator:"\n",cellSeparator:"|",minChars:1,delay:400,matchCase:0,matchSubset:1,matchContains:0,cacheLength:1,mustMatch:0,extraParams:{},loadingClass:"ac_loading",selectFirst:!1,selectOnly:!1,maxItemsToShow:-1,autoFill:!1,width:0},t),t.width=parseInt(t.width,10),this.each(function(){var e=this;new jQuery.autocomplete(e,t)}),this},jQuery.fn.autocompleteArray=function(e,t){return this.autocomplete(null,t,e)},jQuery.fn.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1};